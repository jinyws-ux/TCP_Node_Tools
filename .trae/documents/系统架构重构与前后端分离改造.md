# 系统架构重构与前后端分离改造

## 一、需求分析

1. **报告管理与日志分析整合**：报告管理模块应与日志分析整合，而非独立标签页
2. **报告存储优化**：以节省空间的形式保存报告，而非完整HTML
3. **数据驱动的报告渲染**：打开报告时读取数据，以原有模板形态布局
4. **导出纯净版报告**：支持将报告导出为纯净HTML
5. **前后端分离部署**：支持分别启动前后端，方便服务器部署

## 二、主要改造内容

### 1. 报告存储机制重构

* **创建报告数据模型**：设计报告元数据和内容数据模型
* **实现报告数据存储**：将报告数据存储为JSON格式，而非完整HTML
* **优化存储结构**：
  - 报告元数据：包含报告基本信息（名称、生成时间、日志数量、异常数量等）
  - 报告内容数据：包含日志条目、异常信息等
  - 报告索引：便于快速查询和检索

### 2. 报告渲染机制重构

* **实现数据驱动的报告渲染**：
  - 前端加载报告数据
  - 使用前端模板引擎渲染报告
  - 保持原有报告的UI风格和交互功能
* **改造报告生成流程**：
  - 分析日志后生成报告数据
  - 保存报告数据到数据库或文件系统
  - 报告列表显示报告元数据

### 3. 前后端分离架构调整

* **前端独立部署支持**：
  - 前端代码与后端分离
  - 支持配置API地址
  - 实现静态资源独立部署
* **后端API优化**：
  - 完善报告管理API
  - 实现报告数据的CRUD操作
  - 支持报告导出为纯净HTML

### 4. 报告管理功能整合

* **整合报告管理到日志分析页面**：
  - 在日志分析页面添加报告列表
  - 支持报告的查看、编辑、删除和导出
  - 保持UI一致性
* **实现报告搜索和筛选**：
  - 支持按名称、时间、状态等搜索报告
  - 支持报告的批量操作

### 5. 纯净版报告导出功能

* **实现报告导出API**：
  - 接收报告ID
  - 生成纯净HTML报告
  - 支持下载导出的报告
* **优化导出HTML结构**：
  - 移除不必要的JavaScript
  - 确保导出的报告可以独立打开
  - 保持报告的可读性和完整性

## 三、具体实现步骤

### 步骤1：报告数据模型设计与实现

1. 设计报告元数据模型
2. 设计报告内容数据模型
3. 实现报告数据存储模块
4. 实现报告索引和查询功能

### 步骤2：报告生成流程改造

1. 修改`analyze_logs`方法，生成报告数据而非HTML
2. 实现报告数据保存功能
3. 优化报告生成性能
4. 实现报告数据的版本控制

### 步骤3：前端报告渲染功能实现

1. 创建报告渲染模板
2. 实现报告数据加载和渲染
3. 保持原有报告的UI风格和交互功能
4. 实现报告的实时搜索和筛选

### 步骤4：前后端分离架构调整

1. 调整后端API，支持前后端分离
2. 实现前端配置文件，支持API地址配置
3. 实现前端独立部署支持
4. 优化CORS配置，支持跨域访问

### 步骤5：报告管理功能整合

1. 在日志分析页面添加报告列表
2. 实现报告的查看、编辑、删除和导出功能
3. 实现报告的批量操作
4. 优化报告列表的UI设计

### 步骤6：纯净版报告导出功能实现

1. 实现报告导出API
2. 实现报告数据到HTML的转换
3. 优化导出的HTML结构
4. 支持报告的批量导出

## 四、预期效果

1. **报告存储优化**：报告存储占用空间大幅减少
2. **报告渲染高效**：支持快速加载和渲染报告
3. **前后端分离**：支持分别启动前后端，方便部署到服务器
4. **用户体验一致**：保持原有报告的UI风格和交互功能
5. **功能完善**：支持报告的管理、搜索、筛选、导出等功能

## 五、技术栈

* **后端**：Flask, JSON, 文件系统或数据库
* **前端**：HTML, CSS, JavaScript, 模板引擎
* **报告数据**：JSON格式存储
* **部署**：支持Docker容器化部署

## 六、实施时间估算

* 报告数据模型设计与实现：1-2天
* 报告生成流程改造：1-2天
* 前端报告渲染功能实现：2-3天
* 前后端分离架构调整：1-2天
* 报告管理功能整合：1-2天
* 纯净版报告导出功能实现：1-2天
* 测试和优化：1-2天

## 七、验收标准

1. 报告以节省空间的形式保存
2. 报告列表与日志分析整合
3. 打开报告时以原有模板形态布局
4. 支持导出纯净版报告
5. 支持前后端分离部署
6. 功能完整，用户体验良好
